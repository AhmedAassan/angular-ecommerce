<!-- <div class="auth-wrapper container mt-4">
  <h2 class="text-center mb-2 Register-header">Register</h2>
  <p class="helper text-center mb-4">
    Enter your personal information
  </p>

  <form class="auth-card card shadow-sm p-4 mx-auto" [formGroup]="form" (ngSubmit)="submit()" novalidate>
    
    <div class="mb-3">
      <label class="form-label fw-semibold">Email</label>
      <input type="email" class="form-control" formControlName="email" placeholder="Write Email"
        [class.is-invalid]="form.controls.email.touched && form.controls.email.invalid" />
      <div class="invalid-feedback">Valid email required.</div>
    </div>

    
    <div class="mb-3">
      <label class="form-label fw-semibold">Name</label>
      <input type="text" class="form-control" formControlName="name" placeholder="Write Name"
        [class.is-invalid]="form.controls.name.touched && form.controls.name.invalid" />
      <div class="invalid-feedback">Name is required.</div>
    </div>

   
    <div class="mb-3">
      <label class="form-label fw-semibold">Mobile Number</label>
      <input type="tel" class="form-control" formControlName="mobile" placeholder="write Number"
        [class.is-invalid]="form.controls.mobile.touched && form.controls.mobile.invalid" />
      <div class="invalid-feedback">Numbers only – min 7 digits.</div>
    </div>

    
    <div class="mb-3">
      <label class="form-label fw-semibold">Password</label>
      <input type="password" class="form-control" formControlName="password" placeholder="Write Password"
        [class.is-invalid]="form.controls.password.touched && form.controls.password.invalid" />
      <div class="invalid-feedback">Min 6 characters.</div>
    </div>

    
    <div class="mb-4">
      <label class="form-label fw-semibold">Confirm Password</label>

      <input type="password" class="form-control" formControlName="confirm" placeholder="Confirm Password"
        [class.is-invalid]="
      (form.controls.confirm.touched && form.controls.confirm.invalid) ||
      form.errors?.['mismatch']
    " />

      <div class="invalid-feedback">
        {{ form.errors?.['mismatch'] ? 'Passwords do not match' : 'Required' }}
      </div>
    </div>

  
    <button type="submit" class="btn w-100" [disabled]="form.invalid || loading">
      {{ loading ? 'Signing up…' : 'Sign Up' }}
    </button>
  </form>

  <p class="small text-center p-4">
    Do you have an account?
    <a routerLink="/login">Login</a>
  </p>

  <div *ngIf="errorMsg" class="alert alert-danger mt-3 p-2 text-center">
    {{ errorMsg }}
  </div>
</div> -->

<div class="auth-wrapper container my-5">
  <!-- Header -->
  <div class="auth-header text-center mb-4">
    <h2 class="register-header mb-3">Create Account</h2>
    <p class="helper mb-4">Join us today! Enter your information to get started</p>
  </div>

  <!-- =========================
       STEP 1: MOBILE (Send OTP)
       ========================= -->
  <form class="auth-card card shadow-sm p-4 mx-auto" *ngIf="step() === 1" [formGroup]="step1Form" novalidate>
    <!-- Mobile -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Mobile Number</span>
        <span class="required-asterisk">*</span>
      </label>

      <ngx-material-intl-tel-input [fieldControl]="mobileCtrl" [required]="true" [appearance]="'outline'"
        [enableSearch]="true" [autoIpLookup]="false" [autoSelectCountry]="true" [autoSelectedCountry]="'kw'"
        [preferredCountries]="['kw','sa','ae','qa','bh','om','eg']" [emojiFlags]="false" [hidePhoneIcon]="false"
        placeholder="Mobile number">
      </ngx-material-intl-tel-input>

      <div class="invalid-feedback" *ngIf="hasFieldError('step1','mobileNo')">
        {{ getFieldError('step1','mobileNo') }}
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary w-100" [disabled]="step1Form.invalid || loading()"
        (click)="sendOtp()">
        <span *ngIf="loading()" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        {{ loading() ? 'Sending OTP...' : 'Send OTP' }}
      </button>
    </div>

    <div *ngIf="errorMsg()" class="alert alert-danger mt-3 error-alert" role="alert">
      {{ errorMsg() }}
    </div>

    <div class="auth-footer text-center mt-3">
      <p>Already have an account? <a routerLink="/login" class="login-link">Sign in here</a></p>
    </div>
  </form>

  <!-- =========================
       STEP 2: OTP (Validate)
       ========================= -->
  <form class="auth-card card shadow-sm p-4 mx-auto" *ngIf="step() === 2" [formGroup]="step2Form" novalidate>
    <!-- OTP -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Enter OTP</span>
        <span class="required-asterisk">*</span>
      </label>
      <div class="input-wrapper">
        <div class="input-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 8v4l3 3" />
          </svg>
        </div>
        <input type="text" class="form-control" formControlName="otp" placeholder="OTP received on WhatsApp"
          [class.is-invalid]="hasFieldError('step2','otp')" (input)="clearError()" inputmode="numeric" />
      </div>
      <div class="invalid-feedback" *ngIf="hasFieldError('step2','otp')">
        {{ getFieldError('step2','otp') }}
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary flex-grow-1" [disabled]="step2Form.invalid || loading()"
        (click)="verifyOtp()">
        <span *ngIf="loading()" class="spinner-border spinner-border-sm me-2"></span>
        {{ loading() ? 'Verifying...' : 'Verify OTP' }}
      </button>

      <button type="button" class="btn btn-outline-secondary" [disabled]="!canResend()" (click)="resendOtp()">
        Resend
      </button>
    </div>

    <div *ngIf="errorMsg()" class="alert alert-danger mt-3 error-alert" role="alert">
      {{ errorMsg() }}
    </div>

    <div class="auth-footer text-center mt-3">
      <a href="javascript:void(0)" (click)="step.set(1)">Change mobile number</a>
    </div>
  </form>

  <!-- =========================
       STEP 3: FULL REGISTRATION
       ========================= -->
  <form class="auth-card card shadow-sm p-4 mx-auto" *ngIf="step() === 3" [formGroup]="step3Form" (ngSubmit)="submit()"
    novalidate>
    <!-- Full Name -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Full Name</span>
        <span class="required-asterisk">*</span>
      </label>
      <div class="input-wrapper">
        <div class="input-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        </div>
        <input type="text" class="form-control" formControlName="fullName" placeholder="Enter your full name"
          [class.is-invalid]="hasFieldError('step3','fullName')" (input)="clearError()" autocomplete="name" />
      </div>
      <div class="invalid-feedback" *ngIf="hasFieldError('step3','fullName')">
        {{ getFieldError('step3','fullName') }}
      </div>
    </div>

    <!-- Email -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Email Address</span>
        <span class="required-asterisk">*</span>
      </label>
      <div class="input-wrapper">
        <div class="input-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
            <polyline points="22,6 12,13 2,6" />
          </svg>
        </div>
        <input type="email" class="form-control" formControlName="email" placeholder="Enter your email address"
          [class.is-invalid]="hasFieldError('step3','email')" (input)="clearError()" autocomplete="email" />
      </div>
      <div class="invalid-feedback" *ngIf="hasFieldError('step3','email')">
        {{ getFieldError('step3','email') }}
      </div>
    </div>

    <!-- Gender -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Gender</span>
        <span class="required-asterisk">*</span>
      </label>
      <select class="form-control" formControlName="gender" [class.is-invalid]="hasFieldError('step3','gender')">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <div class="invalid-feedback" *ngIf="hasFieldError('step3','gender')">
        {{ getFieldError('step3','gender') }}
      </div>
    </div>

    <!-- Branch -->
    <div class="form-group mb-3">
      <label class="form-label">Branch</label>
      <select class="form-control" formControlName="branchId">
        <option *ngFor="let b of branches()" [value]="b.id">
          {{ b.englishName }} ({{ b.arabicName }})
        </option>
      </select>
    </div>

    <!-- Password -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Password</span>
        <span class="required-asterisk">*</span>
      </label>
      <div class="input-wrapper">
        <div class="input-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <circle cx="12" cy="16" r="1" />
            <path d="m7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </div>
        <input [type]="showPassword() ? 'text' : 'password'" class="form-control" formControlName="password"
          placeholder="Create a strong password" [class.is-invalid]="hasFieldError('step3','password')"
          (input)="clearError()" autocomplete="new-password" />
        <button type="button" class="password-toggle" (click)="togglePasswordVisibility('password')"
          [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path *ngIf="!showPassword()" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
            <circle *ngIf="!showPassword()" cx="12" cy="12" r="3" />
            <path *ngIf="showPassword()" d="m1 1 22 22" />
            <path *ngIf="showPassword()" d="M6.71 6.71C4.68 8.04 3 10.5 3 12s1.68 3.96 3.71 5.29" />
            <path *ngIf="showPassword()" d="m17.29 17.29C19.32 15.96 21 13.5 21 12s-1.68-3.96-3.71-5.29" />
            <path *ngIf="showPassword()" d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
          </svg>
        </button>
      </div>

      <!-- Strength meter -->
      <div class="password-strength mt-2" *ngIf="step3Form.get('password')?.value">
        <div class="strength-bar">
          <div class="strength-fill" [class]="getPasswordStrengthClass()" [style.width.%]="passwordStrength()"></div>
        </div>
        <div class="strength-text">
          Password strength: <span [class]="getPasswordStrengthClass()">{{ getPasswordStrengthText() }}</span>
        </div>
      </div>

      <div class="invalid-feedback" *ngIf="hasFieldError('step3','password')">
        {{ getFieldError('step3','password') }}
      </div>
    </div>

    <!-- Confirm Password -->
    <div class="form-group mb-3">
      <label class="form-label">
        <span class="label-text">Confirm Password</span>
        <span class="required-asterisk">*</span>
      </label>
      <div class="input-wrapper">
        <div class="input-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="m7 11V7a5 5 0 0 1 10 0v4" />
            <path d="M12 16v1" />
          </svg>
        </div>
        <input [type]="showConfirmPassword() ? 'text' : 'password'" class="form-control"
          formControlName="confirmPassword" placeholder="Confirm your password"
          [class.is-invalid]="hasFieldError('step3','confirmPassword') || step3Form.errors?.['mismatch']"
          (input)="clearError()" autocomplete="new-password" />
        <button type="button" class="password-toggle" (click)="togglePasswordVisibility('confirm')"
          [attr.aria-label]="showConfirmPassword() ? 'Hide password' : 'Show password'">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path *ngIf="!showConfirmPassword()" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
            <circle *ngIf="!showConfirmPassword()" cx="12" cy="12" r="3" />
            <path *ngIf="showConfirmPassword()" d="m1 1 22 22" />
            <path *ngIf="showConfirmPassword()" d="M6.71 6.71C4.68 8.04 3 10.5 3 12s1.68 3.96 3.71 5.29" />
            <path *ngIf="showConfirmPassword()" d="m17.29 17.29C19.32 15.96 21 13.5 21 12s-1.68-3.96-3.71-5.29" />
            <path *ngIf="showConfirmPassword()" d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
          </svg>
        </button>
      </div>
      <div class="invalid-feedback" *ngIf="hasFieldError('step3','confirmPassword') || step3Form.errors?.['mismatch']">
        {{ step3Form.errors?.['mismatch'] ? 'Passwords do not match' : getFieldError('step3','confirmPassword') }}
      </div>
    </div>

    <!-- Terms -->
    <div class="form-group mb-4">
      <div class="form-check">
        <input type="checkbox" class="form-check-input" id="acceptTerms" formControlName="acceptTerms"
          [class.is-invalid]="hasFieldError('step3','acceptTerms')" />
        <label class="form-check-label" for="acceptTerms">
          I agree to the
          <a href="/terms" target="_blank" class="terms-link">Terms of Service</a>
          and
          <a href="/privacy" target="_blank" class="terms-link">Privacy Policy</a>
          <span class="required-asterisk">*</span>
        </label>
      </div>
      <div class="invalid-feedback" *ngIf="hasFieldError('step3','acceptTerms')">
        {{ getFieldError('step3','acceptTerms') }}
      </div>
    </div>

    <!-- Submit -->
    <button type="submit" class="btn btn-primary w-100 submit-btn" [disabled]="step3Form.invalid || loading()">
      <span *ngIf="loading()" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      <svg *ngIf="!loading()" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2" class="me-2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="m22 21-3-3m0 0a5.5 5.5 0 1 0-7.78-7.78 5.5 5.5 0 0 0 7.78 7.78Z" />
      </svg>
      {{ loading() ? 'Creating Account...' : 'Create Account' }}
    </button>

    <!-- Error -->
    <div *ngIf="errorMsg()" class="alert alert-danger mt-3 error-alert" role="alert">
      {{ errorMsg() }}
    </div>

    <!-- Footer -->
    <div class="auth-footer text-center mt-4 pb-2">
      <p class="login-prompt">
        Already have an account?
        <a routerLink="/login" class="login-link">Sign in here</a>
      </p>
    </div>
  </form>
</div>